<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cmdi.dao.SaopinDao">
	<sql id="tablename">fourg_saopin_addr</sql>
  <resultMap type="com.cmdi.model.SaoPinData" id="selectsaopindatamap"></resultMap>
  <select id="selectsaopindata" parameterType="map" resultMap="selectsaopindatamap">
  
  	select timestamp,longitude,latitude,earfcn,r0_rp as rs,max(pci) as pci
  	from <include refid="tablename"></include>
  	where (timestamp,longitude,latitude,earfcn,r0_rp) in
      (SELECT timestamp,longitude,latitude,earfcn,max(r0_rp) as rs 
      	FROM <include refid="tablename"></include>
      	where earfcn in 
      		<foreach collection="list" index="index" item="item" open="("
        		separator="," close=")">
        		#{item,jdbcType=INTEGER}
    		</foreach> 
    		and pci is not null and longitude is not null and latitude is not null
    	group by timestamp,longitude,latitude,earfcn)
    group by timestamp,longitude,latitude,earfcn,r0_rp
</select>

</mapper>